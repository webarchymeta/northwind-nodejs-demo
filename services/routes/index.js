/* ------------------------------------------------------------------------------
 *
 *     This code was generated by CGW X-Script Code Generator.
 *
 *     Archymeta Information Technologies Co., Ltd.
 *
 *     Changes to this file, especially those bit flags, may cause incorrect behavior and will be lost if
 *     the code is regenerated.
 * 
 ------------------------------------------------------------------------------ */

var root = process.cwd(),
    path = require('path'),
    router = require(path.join(root, 'node_modules/express')).Router();

router.use('/:dbsvc', function (req, res, next) {
    if (typeof router.filter !== 'undefined' && router.filter !== null && typeof router.filter[req.params.dbsvc] !== 'undefined' && router.filter[req.params.dbsvc] !== null && router.filter[req.params.dbsvc].allowed) {
        if (router.filter.authenticate && (typeof req.isAuthenticated !== 'function' || !req.isAuthenticated())) {
            res.writeHead(401);
            res.end();
            return;
        }
        var r = require(path.join(root, 'node_modules/express')).Router();
        var dbrouter = require(path.join(__dirname, '/' + req.params.dbsvc)).router;
        dbrouter.vpath = router.vpath + '/' + req.params.dbsvc;
        dbrouter.filter = router.filter[req.params.dbsvc];
        r.use('/', dbrouter);
        r.handle(req, res, next);
    } else {
        res.writeHead(403);
        res.end();
        return;
    }
});

router.use('/', function (req, res, next) {
    next();
});

module.exports.router = router;